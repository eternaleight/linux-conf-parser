# Linux sysctl.confãƒ‘ãƒ¼ã‚µ (è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ¼ã‚µ)
ğŸ”¨ä½œæˆä¸­(WIP)

![CleanShot 2024-10-14 at 02 44 47](https://github.com/user-attachments/assets/d05ac8b0-37eb-42cd-b605-51919885eacd)
![CleanShot 2024-10-16 at 15 08 39](https://github.com/user-attachments/assets/e9762f54-5161-41d3-a480-e88c6b52a076)


ã“ã®Rustãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€`sysctl.conf`å½¢å¼ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã‚’`FxHashMap`ã«æ ¼ç´ã™ã‚‹ãƒ‘ãƒ¼ã‚µã§ã™ã€‚æŒ‡å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å†å¸°çš„ã«æ¢ç´¢ã—ã€`.conf`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§è§£æã—ã¾ã™ã€‚ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚„ç©ºè¡Œã‚’ç„¡è¦–ã—ã€ç‰¹å®šã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

## æ©Ÿèƒ½

- **ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã‚’è§£æ**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã®`key=value`å½¢å¼ã®è¡Œã‚’è§£æã—ã€`FxHashMap`ã«æ ¼ç´ã—ã¾ã™ã€‚
- **ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚­ãƒ¼ã«å¯¾å¿œ**: `key.subkey=value`ã®ã‚ˆã†ã«ãƒ‰ãƒƒãƒˆã§åŒºåˆ‡ã‚‰ã‚ŒãŸã‚­ãƒ¼ã‚’ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸ`FxHashMap`ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚
- **ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚„ç©ºè¡Œã‚’ç„¡è¦–**: `#`ã‚„`;`ã§å§‹ã¾ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚„ç©ºè¡Œã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚
- **å†å¸°çš„ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®`.conf`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æ**: æŒ‡å®šã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®`.conf`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«èª­ã¿è¾¼ã¿ã¾ã™ã€‚
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: è¡Œã®å…ˆé ­ã«`-`ãŒã‚ã‚‹å ´åˆã€ãã®è¡Œã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã—ã€ãã‚Œä»¥å¤–ã®ã‚¨ãƒ©ãƒ¼ã¯`stderr`ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚


### é–‹ç™ºç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®èª¬æ˜

ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€é–‹ç™ºç”¨ã¨æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ç”¨ã§ç•°ãªã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚é–‹ç™ºç’°å¢ƒã§ã¯ã€ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã•ã‚ŒãŸä»®æƒ³çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ä½¿ç”¨ã—ã¦å‹•ä½œã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ã€é–‹ç™ºç”¨ã«ä»®æƒ³çš„ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®èª¬æ˜ã§ã™ã€‚

### é–‹ç™ºç’°å¢ƒã§ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

é–‹ç™ºç”¨ã«ã¯ã€`config/`ä»¥ä¸‹ã«ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®æ§‹é€ å†…ã§`.conf`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’æ¨¡æ“¬çš„ã«å‡¦ç†ã—ã¾ã™ã€‚

```
config/
â”œâ”€â”€ etc/
â”‚   â”œâ”€â”€ sysctl.conf
â”‚   â””â”€â”€ sysctl.d/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ sysctl.d/
â”œâ”€â”€ run/
â”‚   â””â”€â”€ sysctl.d/
â”œâ”€â”€ usr/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ sysctl.d/
â”‚   â””â”€â”€ local/
â”‚       â””â”€â”€ lib/
â”‚           â””â”€â”€ sysctl.d/
```

ã“ã®ä»®æƒ³çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’ã‚‚ã¨ã«ã€å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`.conf`ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹æƒ³å®šã§å‹•ä½œã—ã€å†å¸°çš„ã«ãã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§è¨­å®šã‚’å‡¦ç†ã—ã¾ã™ã€‚

### æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ã§ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ç”¨ã§ã¯ã€å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã‚ã‚‹`/etc/`ã‚„`/usr/lib/`ãªã©ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ä»®æƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ãªãã€ã‚·ã‚¹ãƒ†ãƒ ä¸Šã®å®Ÿéš›ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¯¾è±¡ã¨ã™ã‚‹ãŸã‚ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚„ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãªã©ã®è¨­å®šã«ã‚‚æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

```
/
â”œâ”€â”€ etc/
â”‚   â”œâ”€â”€ sysctl.conf
â”‚   â””â”€â”€ sysctl.d/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ sysctl.d/
â”œâ”€â”€ run/
â”‚   â””â”€â”€ sysctl.d/
â”œâ”€â”€ usr/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ sysctl.d/
â”‚   â””â”€â”€ local/
â”‚       â””â”€â”€ lib/
â”‚           â””â”€â”€ sysctl.d/
```

æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ç”¨ã®ã‚³ãƒ¼ãƒ‰ã¯ã€ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ã™ã‚‹ã‚ˆã†ã«è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚


## ä½¿ç”¨æ–¹æ³•

### 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯æ¬¡ã®å½¢å¼ã§è¨˜è¿°ã—ã¾ã™ï¼š

```bash
# ã‚³ãƒ¡ãƒ³ãƒˆè¡Œ
key1=value1
key2.subkey=value2
key3.subkey1.subkey2=value3

; ã“ã¡ã‚‰ã‚‚ã‚³ãƒ¡ãƒ³ãƒˆè¡Œ
```

- `#`ã‚„`;`ã§å§‹ã¾ã‚‹è¡Œã¯ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ç„¡è¦–ã•ã‚Œã¾ã™ã€‚
- `key=value`å½¢å¼ã®è¡Œã¯ã‚­ãƒ¼ã¨å€¤ã¨ã—ã¦è§£æã•ã‚Œã¾ã™ã€‚ãƒ‰ãƒƒãƒˆï¼ˆ`.`ï¼‰ã§åŒºåˆ‡ã‚‰ã‚ŒãŸã‚­ãƒ¼ã¯ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒãƒƒãƒ—ã¨ã—ã¦æ ¼ç´ã•ã‚Œã¾ã™ã€‚
- è¡Œã®å…ˆé ­ã«`-`ãŒä»˜ã„ã¦ã„ã‚‹å ´åˆã€è¨­å®šã®é©ç”¨ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ãŒç„¡è¦–ã•ã‚Œã¾ã™ã€‚

### 2. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œ

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
cargo run
```

å®Ÿè¡Œã™ã‚‹ã¨ã€æŒ‡å®šã•ã‚ŒãŸ`config`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®ã™ã¹ã¦ã®`.conf`ãƒ•ã‚¡ã‚¤ãƒ«ãŒå†å¸°çš„ã«å‡¦ç†ã•ã‚Œã€ãã‚Œãã‚Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢å¼ã§å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```
File: "config/example1.conf"
{
  "debug": "true",
  "endpoint": "localhost:3000",
  "log": {
    "file": "/var/log/console.log"
  }
}
```

### 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æŒ‡å®š

é–‹ç™ºç’°å¢ƒå‘ã‘ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒªã‚¹ãƒˆãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€ã“ã‚Œã‚‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ã‚ã‚‹`.conf`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«èª­ã¿è¾¼ã¿ã¾ã™ã€‚

```rust
let directories = [
    "config/etc/sysctl.d",
    "config/run/sysctl.d",
    "config/usr/local/lib/sysctl.d",
    "config/usr/lib/sysctl.d",
    "config/lib/sysctl.d",
    "config/etc",
    "config"
];
```

ã“ã®ãƒªã‚¹ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€èª­ã¿è¾¼ã¿ãŸã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½åŠ ãƒ»å‰Šé™¤ã§ãã¾ã™ã€‚

### æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ã§ã®ä½¿ç”¨ã«å‘ã‘ã¦ã€ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ã€å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¯¾è±¡ã¨ã™ã‚‹ãŸã‚ã€é–‹ç™ºæ™‚ã¨ã¯ç•°ãªã‚‹ãƒ‘ã‚¹ãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

```rust
let directories = [
    "/etc/sysctl.d",
    "/run/sysctl.d",
    "/usr/local/lib/sysctl.d",
    "/usr/lib/sysctl.d",
    "/lib/sysctl.d",
    "/etc"
];
```

### æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ã§ã®ä½¿ç”¨æ–¹æ³•

æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ã§ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„ã€‚

1. **é–‹ç™ºç”¨ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã€æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹**  
   ç¾åœ¨ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã«é–‹ç™ºç”¨ã¨æœ¬ç•ªç”¨ã®ã‚³ãƒ¼ãƒ‰ãŒå…±å­˜ã—ã¦ã„ã¾ã™ã€‚å®Ÿéš›ã«æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ã§å‹•ä½œã•ã›ã‚‹éš›ã¯ã€é–‹ç™ºç”¨ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã€ä»¥ä¸‹ã®éƒ¨åˆ†ã‚’æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã‚Œæ›¿ãˆã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

   ```rust
   // main.rs
   
   // é–‹ç™ºç”¨ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
   // mod core;
   // mod utils;
   ...

   // æœ¬ç•ªæƒ³å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
   fn main() -> io::Result<()> {
   // å†å¸°çš„ã«æ¢ç´¢ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
       let directories = [
           "/etc/sysctl.d",
           "/run/sysctl.d",
           "/usr/local/lib/sysctl.d",
           "/usr/lib/sysctl.d",
           "/lib/sysctl.d",
           "/etc",
       ];
   ...
   
   }
   ```

2. **æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ã§ã®å‹•ä½œç¢ºèª**  
   ä¸Šè¨˜ã®å¤‰æ›´ã‚’è¡Œã£ãŸå¾Œã€æœ¬ç•ªã‚·ã‚¹ãƒ†ãƒ ã«é©ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### 4. ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- è¡Œã®å…ˆé ­ã«`-`ãŒä»˜ã„ã¦ã„ã‚‹å ´åˆã€ãã®è¡Œã®ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚
- è¨­å®šå€¤ãŒ4096æ–‡å­—ã‚’è¶…ãˆã‚‹å ´åˆã€è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã€ãã®è¡Œã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚

## å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã¨æ¤œè¨¼
![CleanShot 2024-10-16 at 15 14 29](https://github.com/user-attachments/assets/07c320a4-6053-4096-844e-00345b11d05e)


### `cargo run output` ã§ç©ºã®å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

1. `cargo run output` ã‚’å®Ÿè¡Œã—ã€ç©ºã®å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ« `output.txt` ã‚’ä½œæˆã—ã¾ã™ã€‚
    ```
    cargo run output
    ```

    ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®è¨­å®šã«åŸºã¥ã„ã¦ç©ºã®å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚æ¬¡ã®æ‰‹é †ã§ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚

3. `output.txt` ã‚’ `schema.txt` ã«åå‰ã‚’å¤‰æ›´ã—ã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚schema.txtã§å‹ã®å®šç¾©ã‚’è¡Œã£ã¦ä¸‹ã•ã„ã€‚

    ```bash
    mv output.txt schema.txt
    ```

### `cargo run` ã§.confãƒ•ã‚¡ã‚¤ãƒ«ã‚’JSONå½¢å¼ã§å‡ºåŠ›ã—ã€å‹ã®æ¤œè¨¼ã‚’è¡Œã†

3. å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`schema.txt`ï¼‰ã‚’ä½¿ã£ã¦ã€ã‚·ã‚¹ãƒ†ãƒ ã® `.conf` ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šã‚’æ¤œè¨¼ã—ã€JSONå½¢å¼ã§å‡ºåŠ›ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

    ```bash
    cargo run
    ```

- **å‹•ä½œ**: ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€`.conf` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã«åŸºã¥ã„ã¦è¨­å®šã®æ­£å½“æ€§ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
- **å‡ºåŠ›**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’JSONå½¢å¼ã§è¡¨ç¤ºã—ã€å‹ãŒä¸ä¸€è‡´ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
### ã‚·ãƒ³ãƒ—ãƒ«ãªæ‰‹é †ä¾‹
```bash
# ç©ºã®å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
cargo run output

# output.txtã‚’schema.txtã«åå‰å¤‰æ›´ã‚’å¤‰æ›´ã—ã¦ã€schema.txtã§å‹ã®å®šç¾©ã‚’è¡Œã†
mv output.txt schema.txt

# .confãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šã‚’JSON å½¢å¼ã§å‡ºåŠ›ã—ã€å‹ã®æ¤œè¨¼çµæœã‚‚è¡¨ç¤º
cargo run

## ä½¿ç”¨æ–¹æ³•

å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ¬¡ã®å½¢å¼ã§è¨˜è¿°ã—ã¾ã™

ä¾‹ï¼šschema.txt

log.file -> string
endpoint -> string
net.ipv4.tcp_syncookies -> int
kernel.modprobe ->string
debug -> bool
kernel.sysrq -> int
log.name -> string
kernel.domainname -> string
net.core.somaxconn -> float
kernel.panic -> string
vm.swappiness -> int
fs.file-max -> int
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å‹ãŒä¸€è‡´ã—ã¦ã„ãªã„å ´åˆ
```
example1.conf
endpoint = localhost:3000
debug = 1234
log.file = /var/log/console.log

99-example.conf
kernel.sysrq=`'`.|Â¥/;""?`

20-extra.conf
net.core.somaxconn = asdf

10-custom.conf
vm.swappiness = 10.1
fs.file-max = 100000
```
ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™
```bash
Error: ã‚­ãƒ¼ 'debug' ã®å€¤ '1234' ã¯ãƒ–ãƒ¼ãƒ«å€¤ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
Error: ã‚­ãƒ¼ 'kernel.sysrq' ã®å€¤ '`'`.|Â¥/;""?`' ã¯æ•´æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
Error: ã‚­ãƒ¼ 'net.core.somaxconn' ã®å€¤ 'asdf' ã¯æµ®å‹•å°æ•°ç‚¹æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
Error: ã‚­ãƒ¼ 'vm.swappiness' ã®å€¤ '10.1' ã¯æ•´æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚
```

ã¾ãŸã¯ã€ã‚¹ã‚­ãƒ¼ãƒ(schema.txt)ã®å®šç¾©ã§ã“ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„å‹ã‚’å…¥åŠ›ã™ã‚‹ã¨
```
ä¾‹ï¼šschema.txt

log.file -> #ç©ºæ–‡å­—
endpoint -> asdf
vm.swappiness ->'string' #ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã‚€
```

ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™
```bash
Error: ã‚­ãƒ¼ 'log.file' ã®ã‚¹ã‚­ãƒ¼ãƒå‹ '' ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
Error: ã‚­ãƒ¼ 'endpoint' ã®ã‚¹ã‚­ãƒ¼ãƒå‹ 'asdf' ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
Error: ã‚­ãƒ¼ 'vm.swappiness' ã®ã‚¹ã‚­ãƒ¼ãƒå‹ ''string'' ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
```


## 4096æ–‡å­—ã‚’è¶…ãˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
![CleanShot 2024-10-10 at 17 05 45](https://github.com/user-attachments/assets/8a47572a-1c58-4f44-9f87-a232bbcc9ee0)


ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ã€`value.too.long` ã«4096æ–‡å­—ã‚’è¶…ãˆã‚‹å€¤ãŒå«ã¾ã‚Œã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã éš›ã«ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ­£ã—ãã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã¦çµ‚äº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

### ä½¿ç”¨æ–¹æ³•

#### 1. ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ

ã¾ãšã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã€`4096æ–‡å­—ã‚’è¶…ãˆã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«` ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

```sh
sh sh.sh
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`config` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã« `long_value_test.conf` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€`value.too.long` ã‚­ãƒ¼ã«å¯¾ã—ã¦4096æ–‡å­—ã‚’è¶…ãˆã‚‹å€¤ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

#### 2. ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œ

æ¬¡ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh
cargo run
```

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒ `long_value_test.conf` ã‚’èª­ã¿è¾¼ã‚€ã¨ã€4096æ–‡å­—ã‚’è¶…ãˆã‚‹å€¤ãŒæ¤œå‡ºã•ã‚Œã‚‹ãŸã‚ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚å‡ºåŠ›ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```sh
File: "config/long_value_test.conf"
thread 'main' panicked at src/main.rs:35:17:
Error: ã‚­ãƒ¼ 'value.too.long' ã®å€¤ãŒ4096æ–‡å­—ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚ğŸ‘€
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã“ã®ã‚¨ãƒ©ãƒ¼ã‚’æ¤œçŸ¥ã™ã‚‹ã¨ã€é©åˆ‡ã«çµ‚äº†ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é•·ã™ãã‚‹å€¤ãŒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒç•°å¸¸ãªæŒ™å‹•ã‚’é˜²ãã€é©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã¦çµ‚äº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚



## é–¢æ•°ã®èª¬æ˜

#### `parse_sysctl_conf(file_path: &Path) -> io::Result<FxHashMap<String, FxHashMap<String, String>>>`

æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€å„è¡Œã‚’è§£æã—ã¦`FxHashMap`ã«æ ¼ç´ã—ã¾ã™ã€‚è¡Œã®å…ˆé ­ã«`-`ãŒã‚ã‚‹å ´åˆã€ãã®è¡Œã®ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚

#### `insert_nested_key(map: &mut FxHashMap<String, FxHashMap<String, String>>, key: &str, value: &str)`

`key.subkey=value`ã®ã‚ˆã†ã«ãƒ‰ãƒƒãƒˆã§åŒºåˆ‡ã‚‰ã‚ŒãŸã‚­ãƒ¼ã‚’ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒãƒƒãƒ—ã«å¤‰æ›ã—ã¦æŒ¿å…¥ã—ã¾ã™ã€‚

#### `parse_all_sysctl_files(directories: &[&str]) -> io::Result<()>`

è¤‡æ•°ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å†å¸°çš„ã«æ¢ç´¢ã—ã€ã™ã¹ã¦ã®`.conf`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã¦å‡ºåŠ›ã—ã¾ã™ã€‚

## ä½¿ç”¨ä¾‹

### å…¥åŠ›ä¾‹ 1

`config/example1.conf`ãƒ•ã‚¡ã‚¤ãƒ«ï¼š

```bash
endpoint = localhost:3000
debug = true
log.file = /var/log/console.log
```

### å‡ºåŠ›ä¾‹ 1

```bash
File: "config/example1.conf"
{
  "debug": "true",
  "endpoint": "localhost:3000",
  "log": {
    "file": "/var/log/console.log"
  }
}
```

### å…¥åŠ›ä¾‹ 2

`config/example2.conf`ãƒ•ã‚¡ã‚¤ãƒ«ï¼š

```bash
endpoint = localhost:3000
# debug = true
log.file = /var/log/console.log
log.name = default.log
```

### å‡ºåŠ›ä¾‹ 2

```bash
File: "config/example2.conf"
{
  "endpoint": "localhost:3000",
  "log": {
    "file": "/var/log/console.log",
    "name": "default.log"
  }
}
```


## ãƒ†ã‚¹ãƒˆä»•æ§˜ã¨ä½¿ã„æ–¹
![CleanShot 2024-10-16 at 20 37 50](https://github.com/user-attachments/assets/6d649b7a-9959-4875-8559-b8881a3e3e66)

ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã¯ã€è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚å„ãƒ†ã‚¹ãƒˆã§ã¯ã€`sysctl.conf`å½¢å¼ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æã—ã€ç‰¹å®šã®ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œã—ãŸå‹•ä½œã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆã¯ã€ç‰¹å®šã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã®æ­£ã—ã„è§£æãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ–¹æ³•

1. **`cargo test` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨**  
   ãƒ†ã‚¹ãƒˆã¯ `cargo test` ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆç”¨ã«å®šç¾©ã•ã‚ŒãŸé–¢æ•°ãŒé †æ¬¡å®Ÿè¡Œã•ã‚Œã€çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

   ```bash
   # ãƒ†ã‚¹ãƒˆã‚’é€æ¬¡å®Ÿè¡Œã—ãŸã„ã®ã§ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã™ã‚‹
   cargo test -- --test-threads=1
   ```

**`cargo test`**:
   - Rustã®ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã§ã‚ã‚‹Cargoã‚’ä½¿ç”¨ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚`cargo test`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã€çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

**`--`**:
   - `cargo test` ã‚³ãƒãƒ³ãƒ‰ã«æ¸¡ã™ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã€ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆRustã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³ï¼‰ã«æ¸¡ã™ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’åŒºåˆ¥ã™ã‚‹ãŸã‚ã®åŒºåˆ‡ã‚Šã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¾Œã‚ã«ç¶šãã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã«æ¸¡ã•ã‚Œã¾ã™ã€‚

**`--test-threads=1`**:
   - ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã«æ¸¡ã•ã‚Œã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ•°ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã“ã®ä¾‹ã§ã¯ã€`1` ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆã¯ä¸¦åˆ—ã«å®Ÿè¡Œã•ã‚Œãšã€é †æ¬¡å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

Rustã®ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã¯è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ä¸¦åˆ—ã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ãŒã€`--test-threads=1` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã‚’1ã¤ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§é †æ¬¡å®Ÿè¡Œã—ã¾ã™ã€‚
- ãƒ†ã‚¹ãƒˆãŒä¸¦åˆ—å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿ç«¶åˆã‚„ãƒªã‚½ãƒ¼ã‚¹ã®å…±æœ‰ã«ã‚ˆã£ã¦å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å ´åˆã€‚
- ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œé †åºãŒé‡è¦ãªå ´åˆã€‚
- ä¸¦è¡Œå®Ÿè¡Œã«ã‚ˆã£ã¦ãƒ‡ãƒãƒƒã‚°ãŒé›£ã—ããªã‚‹å•é¡Œã‚’å›é¿ã—ãŸã„å ´åˆã€‚


2. **å„ãƒ†ã‚¹ãƒˆã®å‹•ä½œ**  
   ãƒ†ã‚¹ãƒˆé–¢æ•°ã¯ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã«å¿œã˜ã¦ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚„æ­£å¸¸å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚ä»¥ä¸‹ã§ã€å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æ¦‚è¦ã‚’èª¬æ˜ã—ã¾ã™ã€‚


### 1. `test_non_existent_file`

- **æ¦‚è¦**: å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã“ã†ã¨ã—ãŸå ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç¢ºèªã—ã¾ã™ã€‚
- **æœŸå¾…çµæœ**: å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€`std::io::ErrorKind::NotFound` ã‚¨ãƒ©ãƒ¼ãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```rust
#[test]
fn test_non_existent_file() {
    let file_path = Path::new("non_existent.conf");
    let result = parse_sysctl_conf(file_path);
    assert!(result.is_err());
    if let Err(e) = result {
        assert_eq!(e.kind(), std::io::ErrorKind::NotFound);
    }
}
```

### 2. `test_value_too_long`

- **æ¦‚è¦**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å€¤ãŒ4096æ–‡å­—ã‚’è¶…ãˆãŸå ´åˆã«ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒãƒ‘ãƒ‹ãƒƒã‚¯ã‚’ç™ºç”Ÿã•ã›ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ã“ã®ãƒ†ã‚¹ãƒˆã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§ã‚’ä¿æŒã™ã‚‹ãŸã‚ã«ã€ç‰¹å®šã®é•·ã•ã‚’è¶…ãˆã‚‹è¨­å®šå€¤ã«å¯¾ã—ã¦å³æ ¼ãªåˆ¶é™ã‚’æ–½ã™ã“ã¨ã®é‡è¦æ€§ã‚’å¼·èª¿ã—ã¾ã™ã€‚
- **æœŸå¾…çµæœ**: `should_panic` å±æ€§ã‚’ä½¿ç”¨ã—ã¦ã€è¨­å®šå€¤ãŒ4096æ–‡å­—ã‚’è¶…ãˆã‚‹ã¨ãã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒãƒ‘ãƒ‹ãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ã“ã®ãƒ‘ãƒ‹ãƒƒã‚¯ã¯ã€è¨­å®šå€¤ãŒé•·ã™ãã‚‹ãŸã‚ã«äºˆæœŸã›ãšèµ·ã“ã‚‹çŠ¶æ…‹ã‚’æ¨¡å€£ã—ã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å…¨æ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

```rust
#[test]
#[should_panic(expected = "å€¤ãŒ4096æ–‡å­—ã‚’è¶…ãˆã¦ã„ã¾ã™")]
fn test_value_too_long() {
    let long_value = "A".repeat(MAX_VALUE_LENGTH + 1);
    let content = format!("long.key = {}", long_value);
    let file_path = setup_test_file("long_value.conf", &content);

    // ã“ã®é–¢æ•°å‘¼ã³å‡ºã—ã¯ panic ã‚’å¼•ãèµ·ã“ã™ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¦ã„ã‚‹
    let _ = parse_sysctl_conf(&file_path);
}
```

### 3. `test_valid_conf_file`

- **æ¦‚è¦**: æ­£å¸¸ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€å†…å®¹ãŒæ­£ã—ããƒ‘ãƒ¼ã‚¹ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚
- **æœŸå¾…çµæœ**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ã‚­ãƒ¼ã¨å€¤ãŒæ­£ã—ã `FxHashMap` ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```rust
#[test]
fn test_valid_conf_file() {
    let content = "net.ipv4.tcp_syncookies = 1\nfs.file-max = 2097152";
    let file_path = setup_test_file("valid.conf", content);

    let result = parse_sysctl_conf(&file_path);
    assert!(result.is_ok(), "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸ");

    let map = result.unwrap();
    println!("{:?}", map);

    assert_eq!(
        map.get("net.ipv4.tcp_syncookies")
            .expect("tcp_syncookies ãŒå­˜åœ¨ã—ã¾ã›ã‚“"),
        "1"
    );
    assert_eq!(
        map.get("fs.file-max").expect("file-max ãŒå­˜åœ¨ã—ã¾ã›ã‚“"),
        "2097152"
    );
    cleanup_test_files();
}
```

### 4. `test_parse_all_sysctl_files`

- **æ¦‚è¦**: å†å¸°çš„ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¢ç´¢ã—ã€`sysctl` è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£ã—ãèª­ã¿è¾¼ã‚“ã§ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã§ã™ã€‚è¤‡æ•°ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ä¿å­˜ã•ã‚ŒãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ãã‚Œãã‚Œã®è¨­å®šé …ç›®ãŒã‚¹ã‚­ãƒ¼ãƒã«åŸºã¥ã„ã¦é©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
- **æœŸå¾…çµæœ**: å„ `sysctl` è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå†å¸°çš„ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã‹ã‚‰æ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã€ãƒ‘ãƒ¼ã‚¹ã•ã‚ŒãŸçµæœãŒ `FxHashMap` ã«æœŸå¾…é€šã‚Šã«æ ¼ç´ã•ã‚Œã‚‹ã“ã¨ã€‚ã¾ãŸã€ã‚¹ã‚­ãƒ¼ãƒã«åŸºã¥ã„ãŸæ¤œè¨¼ãŒæˆåŠŸã—ã€ã‚¨ãƒ©ãƒ¼ãªãçµæœãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã€‚

```rust
/// å†å¸°çš„ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªèª­ã¿è¾¼ã¿ã®ãƒ†ã‚¹ãƒˆ
#[test]
fn test_parse_all_sysctl_files() -> Result<(), Box<dyn std::error::Error>> {
    let content1 = "net.ipv4.tcp_syncookies = 1";
    let content2 = "fs.file-max = 2097152";

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    setup_test_file("dir1/test1.conf", content1);
    setup_test_file("dir1/subdir/test2.conf", content2);

    // å†å¸°çš„ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¢ç´¢ã—ã¦ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
    let directories = ["test_data/dir1"];

    // ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
    let schema_path = Path::new("schema.txt");
    let schema = schema::load_schema(schema_path)?;

    let mut result_map = FxHashMap::default();
    let result = parse_all_sysctl_files(&directories, &schema, &mut result_map);

    // ãƒ‘ãƒ¼ã‚¹çµæœã‚’ãƒ‡ãƒãƒƒã‚°è¡¨ç¤º
    println!("ãƒ‘ãƒ¼ã‚¹çµæœ: {:?}", result_map);

    // ãƒ‘ãƒ¼ã‚¹ãŒæˆåŠŸã—ãŸã“ã¨ã‚’ç¢ºèª
    assert!(result.is_ok(), "Sysctlãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸ");

    // ãƒ‘ãƒ¼ã‚¹çµæœã®æ¤œè¨¼
    assert_eq!(
        result_map.get("net.ipv4.tcp_syncookies"),
        Some(&"1".to_string())
    );
    assert_eq!(result_map.get("fs.file-max"), Some(&"2097152".to_string()));

    // ãƒ†ã‚¹ãƒˆå¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    cleanup_test_files();

    Ok(())
}
```

### 5. `test_load_valid_schema`

- **æ¦‚è¦**: æ­£å¸¸ãªã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ãã®å†…å®¹ãŒæ­£ã—ãè§£æã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã§ã™ã€‚ã‚¹ã‚­ãƒ¼ãƒã®å„é …ç›®ãŒæœŸå¾…é€šã‚Šã®ãƒ‡ãƒ¼ã‚¿å‹ã¨å¯¾å¿œã—ã¦ã„ã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
- **æœŸå¾…çµæœ**: ã‚¹ã‚­ãƒ¼ãƒãŒæ­£ã—ããƒ­ãƒ¼ãƒ‰ã•ã‚Œã€å„ã‚­ãƒ¼ã«å¯¾å¿œã™ã‚‹å‹ï¼ˆ`string`ã€`int`ã€`bool`ã€`float`ï¼‰ãŒ `FxHashMap` ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```rust
#[test]
fn test_load_valid_schema() {
    let schema_content = r#"
    key1 -> string
    key2 -> int
    key3 -> bool
    key4 -> float
    "#;
    let schema_path = setup_test_schema("valid_schema.txt", schema_content);
    let result = load_schema(&schema_path);
    assert!(result.is_ok(), "ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ");

    let schema = result.unwrap();
    assert_eq!(schema.get("key1").unwrap(), "string");
    assert_eq!(schema.get("key2").unwrap(), "int");
    assert_eq!(schema.get("key3").unwrap(), "bool");
    assert_eq!(schema.get("key4").unwrap(), "float");

    cleanup_test_files();
}
```

### 6. `test_load_invalid_schema`

- **æ¦‚è¦**: ä¸æ­£ãªå½¢å¼ã‚’å«ã‚€ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡ã«è¡Œã‚ã‚Œã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã§ã™ã€‚ä¸æ­£ãªè¡ŒãŒã‚ã£ã¦ã‚‚ã€æ®‹ã‚Šã®ã‚¹ã‚­ãƒ¼ãƒé …ç›®ãŒæ­£ã—ããƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
- **æœŸå¾…çµæœ**: ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ä¸æ­£ãªè¡Œã¯ç„¡è¦–ã•ã‚Œã€ä»–ã®æ­£ã—ã„è¡ŒãŒæ­£ã—ããƒ‘ãƒ¼ã‚¹ã•ã‚Œã‚‹ã“ã¨ã€‚

```rust
#[test]
fn test_load_invalid_schema() {
    let schema_content = r#"
    key1 -> string
    invalid_format_line
    key2 -> int
    key3 -> float
    "#;
    let schema_path = setup_test_schema("invalid_schema.txt", schema_content);
    let result = load_schema(&schema_path);

    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé©åˆ‡ã«è¡¨ç¤ºã•ã‚Œã€çµæœãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª
    assert!(result.is_ok(), "ä¸æ­£ãªå½¢å¼ã®è¡Œã‚’ç„¡è¦–ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“");

    let schema = result.unwrap();
    assert_eq!(schema.get("key1").unwrap(), "string");
    assert_eq!(schema.get("key2").unwrap(), "int");
    assert_eq!(schema.get("key3").unwrap(), "float");

    cleanup_test_files();
}
```

### 7. `test_validate_against_valid_schema_with_float`

- **æ¦‚è¦**: æµ®å‹•å°æ•°ç‚¹æ•°ã‚’å«ã‚€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒã€ã‚¹ã‚­ãƒ¼ãƒã«åŸºã¥ã„ã¦æ­£ã—ãæ¤œè¨¼ã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã§ã™ã€‚è¤‡æ•°ã®ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿å‹ãŒã‚¹ã‚­ãƒ¼ãƒã«å¯¾ã—ã¦é©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
- **æœŸå¾…çµæœ**: å„è¨­å®šé …ç›®ï¼ˆ`string`ã€`int`ã€`bool`ã€`float`ï¼‰ãŒã‚¹ã‚­ãƒ¼ãƒã«åŸºã¥ã„ã¦æ­£ã—ãæ¤œè¨¼ã•ã‚Œã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„ã“ã¨ã€‚

```rust
#[test]
fn test_validate_against_valid_schema_with_float() {
    let mut config = FxHashMap::default();
    config.insert("key1".to_string(), "value".to_string()); // æ­£ã—ã„ string
    config.insert("key2".to_string(), "42".to_string()); // æ­£ã—ã„ int
    config.insert("key3".to_string(), "true".to_string()); // æ­£ã—ã„ bool
    config.insert("key4".to_string(), "3.14".to_string()); // æ­£ã—ã„ float

    let mut schema = FxHashMap::default();
    schema.insert("key1".to_string(), "string".to_string());
    schema.insert("key2".to_string(), "int".to_string());
    schema.insert("key3".to_string(), "bool".to_string());
    schema.insert("key4".to_string(), "float".to_string());

    let result = validate_against_schema(&config, &schema);
    assert!(result.is_ok(), "æ¤œè¨¼ã«æˆåŠŸã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™");
}
```

### 8. `test_validate_with_extra_key`

- **æ¦‚è¦**: ã‚¹ã‚­ãƒ¼ãƒã«ã¯å®šç¾©ã•ã‚Œã¦ã„ãªã„ä½™åˆ†ãªã‚­ãƒ¼ãŒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®ã‚­ãƒ¼ãŒé©åˆ‡ã«æ¤œå‡ºã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã§ã™ã€‚ä½™åˆ†ãªã‚­ãƒ¼ãŒã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
- **æœŸå¾…çµæœ**: ã‚¹ã‚­ãƒ¼ãƒã«å­˜åœ¨ã—ãªã„ã‚­ãƒ¼ãŒæ¤œå‡ºã•ã‚Œã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã€‚

```rust
#[test]
fn test_validate_with_extra_key() {
    let mut config = FxHashMap::default();
    config.insert("key1".to_string(), "value".to_string());
    config.insert("extra_key".to_string(), "value".to_string()); // ã‚¹ã‚­ãƒ¼ãƒã«å­˜åœ¨ã—ãªã„ã‚­ãƒ¼

    let mut schema = FxHashMap::default();
    schema.insert("key1".to_string(), "string".to_string());

    let result = validate_against_schema(&config, &schema);
    assert!(result.is_err(), "æ¤œè¨¼ã¯å¤±æ•—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™");

    let errors = result.unwrap_err();
    assert!(errors.contains("ã‚­ãƒ¼ 'extra_key' ã¯ã‚¹ã‚­ãƒ¼ãƒã«å­˜åœ¨ã—ã¾ã›ã‚“"));
}
```

### 9. `test_validate_mixed_invalid_types`

- **æ¦‚è¦**: ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å‹ãŒè¤‡æ•°å«ã¾ã‚Œã¦ã„ã‚‹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒã€ã‚¹ã‚­ãƒ¼ãƒã«åŸºã¥ã„ã¦æ­£ã—ãã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã§ã™ã€‚å„é …ç›®ãŒã‚¹ã‚­ãƒ¼ãƒã«æº–æ‹ ã—ã¦ã„ãªã„å ´åˆã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿”ã•ã‚Œã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
- **æœŸå¾…çµæœ**: ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å‹ã«å¯¾ã—ã¦é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã€æ¤œè¨¼ãŒå¤±æ•—ã™ã‚‹ã“ã¨ã€‚

```rust
#[test]
fn test_validate_mixed_invalid_types() {
    let mut config = FxHashMap::default();

    // å…¨ã¦ä¸æ­£ãªå€¤ã«ã™ã‚‹
    config.insert("key1".to_string(), "3.14".to_string()); // ä¸æ­£ãª string (float ãŒå…¥ã£ã¦ã„ã‚‹)
    config.insert("key2".to_string(), "value".to_string()); // ä¸æ­£ãª int (string ãŒå…¥ã£ã¦ã„ã‚‹)
    config.insert("key3".to_string(), "3.14".to_string()); // ä¸æ­£ãª int (float ãŒå…¥ã£ã¦ã„ã‚‹)
    config.insert("key4".to_string(), "123".to_string()); // ä¸æ­£ãª bool (int ãŒå…¥ã£ã¦ã„ã‚‹)
    config.insert("key5".to_string(), "value".to_string()); // ä¸æ­£ãª bool (string ãŒå…¥ã£ã¦ã„ã‚‹)
    config.insert("key6".to_string(), "true".to_string()); // ä¸æ­£ãª float (bool ãŒå…¥ã£ã¦ã„ã‚‹)
    config.insert("key7".to_string(), "true".to_string()); // ä¸æ­£ãª string (bool ãŒå…¥ã£ã¦ã„ã‚‹)

    let mut schema = FxHashMap::default();

    schema.insert("key1".to_string(), "string".to_string()); // key1 ã¯æ–‡å­—åˆ—ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„
    schema.insert("key2".to_string(), "int".to_string()); // key2 ã¯æ•´æ•°ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„
    schema.insert("key3".to_string(), "int".to_string()); // key3 ã¯æ•´æ•°ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„
    schema.insert("key4".to_string(), "bool".to_string()); // key4 ã¯ãƒ–ãƒ¼ãƒ«å€¤ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„
    schema.insert("key5".to_string(), "bool".to_string()); // key5 ã¯ãƒ–ãƒ¼ãƒ«å€¤ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„
    schema.insert("key6".to_string(), "float".to_string()); // key6 ã¯æµ®å‹•å°æ•°ç‚¹ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„
    schema.insert("key7".to_string(), "string".to_string()); // key7 ã¯æ–‡å­—åˆ—ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„

    let result = validate_against_schema(&config, &schema);

    assert!(result.is_err(), "æ¤œè¨¼ã¯å¤±æ•—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™");

    let errors = result.unwrap_err();

    assert!(errors.contains("ã‚­ãƒ¼ 'key1' ã®å€¤ '3.14' ã¯æ•°å€¤ã§ã¯ãªãã€æ–‡å­—åˆ—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚"));
    assert!(errors.contains("ã‚­ãƒ¼ 'key2' ã®å€¤ 'value' ã¯æ•´æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“"));
    assert!(errors.contains("ã‚­ãƒ¼ 'key3' ã®å€¤ '3.14' ã¯æ•´æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“"));
    assert!(errors.contains("ã‚­ãƒ¼ 'key4' ã®å€¤ '123' ã¯ãƒ–ãƒ¼ãƒ«å€¤ã§ã¯ã‚ã‚Šã¾ã›ã‚“"));
    assert!(errors.contains("ã‚­ãƒ¼ 'key5' ã®å€¤ 'value' ã¯ãƒ–ãƒ¼ãƒ«å€¤ã§ã¯ã‚ã‚Šã¾ã›ã‚“"));
    assert!(errors.contains("ã‚­ãƒ¼ 'key6' ã®å€¤ 'true' ã¯æµ®å‹•å°æ•°ç‚¹æ•°ã§ã¯ã‚ã‚Šã¾ã›ã‚“"));
    assert!(errors.contains("ã‚­ãƒ¼ 'key7' ã®å€¤ 'true' ã¯ãƒ–ãƒ¼ãƒ«å€¤ã§ã¯ãªãã€æ–‡å­—åˆ—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚"));
}
```

## ãƒ†ã‚¹ãƒˆé–¢æ•°ã®ä½¿ã„æ–¹

- å„ãƒ†ã‚¹ãƒˆé–¢æ•°ã¯ç‰¹å®šã®ã‚·ãƒŠãƒªã‚ªã«å¯¾ã—ã¦æ­£ã—ãå‹•ä½œã™ã‚‹ã‹ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾Œã«ä¸€æ™‚çš„ã«ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€`cleanup_test_files` é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆçµæœã®ç¢ºèªæ–¹æ³•

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒé †ç•ªã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹ã¨ "ok" ãŒè¡¨ç¤ºã•ã‚Œã€å¤±æ•—ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚

### å®Ÿè¡Œä¾‹

```bash
running 9 tests
test test_non_existent_file ... ok
test test_parse_all_sysctl_files ... ok
test test_valid_conf_file ... ok
test test_value_too_long - should panic ... ok
test tests::test_load_invalid_schema ... ok
test tests::test_load_valid_schema ... ok
test tests::test_validate_against_valid_schema_with_float ... ok
test tests::test_validate_mixed_invalid_types ... ok
test tests::test_validate_with_extra_key ... ok

test result: ok. 9 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.01s
```

å„ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚Œã°å•é¡Œãªãå‹•ä½œã—ã¦ã„ã¾ã™ã€‚


## ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆ
![CleanShot 2024-10-11 at 16 51 30](https://github.com/user-attachments/assets/fa2d54dc-92c0-4c66-9ba6-00f49547951d)


ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ã€Rustãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

## 1. **nightly ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**

ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€Rustã® `nightly` ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ãŒå¿…è¦ã§ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```bash
rustup install nightly
```


## 2. **ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®å®Ÿè¡Œ**

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
```bash
cargo +nightly bench
```
`stableãƒãƒ£ãƒ³ãƒãƒ«` Rustã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ£ãƒ³ãƒãƒ«ã®ã¾ã¾å®Ÿè¡Œã§ãã‚‹ã€‚
ã¾ãŸã¯
```bash
cargo bench
```
`nightly` ãƒãƒ£ãƒ³ãƒãƒ«ã§å®Ÿè¡Œã§ãã‚‹ã€‚


`stable` ãƒãƒ£ãƒ³ãƒãƒ«ã§ã¯ã€**å®‰å®šç‰ˆã®æ©Ÿèƒ½ã®ã¿**ãŒä½¿ç”¨ã§ãã€ãƒã‚°ä¿®æ­£ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚æ–°æ©Ÿèƒ½ã¯ã€ã¾ãš `nightly` ãƒãƒ£ãƒ³ãƒãƒ«ã§ãƒ†ã‚¹ãƒˆã•ã‚Œã€ãã®å¾Œ `beta` ã‚’çµŒã¦ `stable` ã«å°å…¥ã•ã‚Œã¾ã™ã€‚

### è£œè¶³æƒ…å ±:
- **`stable` ãƒãƒ£ãƒ³ãƒãƒ«**ã¯ã€Rustã®æœ€ã‚‚å®‰å®šã—ãŸãƒªãƒªãƒ¼ã‚¹ã§ã™ã€‚ã“ã‚Œã¯ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç”¨é€”ã§ã®ä½¿ç”¨ãŒæ¨å¥¨ã•ã‚Œã¦ãŠã‚Šã€äºˆæœŸã—ãªã„ç ´å£Šçš„ãªå¤‰æ›´ãŒè¡Œã‚ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
- **`nightly` ãƒãƒ£ãƒ³ãƒãƒ«**ã¯ã€å®Ÿé¨“çš„ãªæ–°æ©Ÿèƒ½ã‚„æœ€å…ˆç«¯ã®å¤‰æ›´ãŒå«ã¾ã‚Œã‚‹ãŸã‚ã€é–‹ç™ºä¸­ã®æ–°æ©Ÿèƒ½ã‚’è©¦ã—ãŸã‚Šã€ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®ã‚ˆã†ãªä¸€éƒ¨ã®ç‰¹å®šæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ãŸã‚Šã™ã‚‹éš›ã«å¿…è¦ã§ã™ã€‚


## nightly ãƒãƒ£ãƒ³ãƒãƒ«ã«åˆ‡ã‚Šæ›¿ãˆã‚‹

### 1. **nightly ãƒãƒ£ãƒ³ãƒãƒ«ã®è¨­å®š**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§ `nightly` ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

```bash
rustup override set nightly
```

ã“ã‚Œã§ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ `nightly` ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

### 2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ç¢ºèª
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦nightlyãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚
```bash
rustup show
```

### 3. **stable ãƒãƒ£ãƒ³ãƒãƒ«ã«æˆ»ã™**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã§ `stable` ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

```bash
rustup override set stable
```

stable ãƒãƒ£ãƒ³ãƒãƒ«ã«æˆ»ã‚Šã¾ã™ã€‚


## 3. **çµæœã®ç¢ºèª**

å®Ÿè¡Œå¾Œã€å„ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®å®Ÿè¡Œæ™‚é–“ãŒãƒŠãƒç§’å˜ä½ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªçµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
test benchmarks::bench_empty_conf_file        ... bench:     114,022.41 ns/iter (+/- 48,714.07)
test benchmarks::bench_large_conf_file        ... bench:     636,778.90 ns/iter (+/- 247,165.45)
test benchmarks::bench_parse_all_sysctl_files ... bench:     498,996.82 ns/iter (+/- 311,588.69)
test benchmarks::bench_parse_sysctl_conf      ... bench:     377,210.36 ns/iter (+/- 33,725.80)
```

- **ns/iter**: 1å›ã®å‡¦ç†ã«ã‹ã‹ã£ãŸæ™‚é–“ï¼ˆãƒŠãƒç§’ï¼‰ã€‚
- **(+/- XXX)**: æ¨™æº–åå·®ã€‚å‡¦ç†æ™‚é–“ã®ã°ã‚‰ã¤ãã‚’ç¤ºã—ã¾ã™ã€‚

